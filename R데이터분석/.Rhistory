"
### </memo> ##############################################
### <default_settings> ###################################
# Library ------------------
library(jsonlite)
library(httr)
library(stringr)
library(dplyr)
library(rJava); library(KoNLP)
# Directory ----------------
setwd("개별프로젝트")
getwd()
# DEFINE -------------------
XML <<- "XML"
JSON <<- "JSON"
test_res <- get_blogData("원피스", 1, JSON)
test_res
clear
clear()
test_res
rm(write_to_JSON)
write_to_JSON(test_res, "분석용", TXT)
# 읽을 수 있는 UTF-8로 export하는 function
write_to_JSON <- function(DATA, NAME, TYPE="JSON"){
res <- DATA
Encoding(res) <- "utf-8"
write(res, file=paste(NAME, TYPE, sep="."))
}
write_to_JSON(test_res, "분석용", TXT)
TXT <<- "TXT"
write_to_JSON(test_res, "분석용", TXT)
test_res
onepiece <- gsub("\n","", test_res)
onepiece
onepiece
onepiece <- gsub("<b>","<b_open>",onepiece)
onepiece
onepiece <- gsub("</b>","<b_close>",onepiece)
onepiece
onepiece <- gsub("/","",onepiece)
onepiece
onepiece <- gsub("\n","", test_res)
onepiece <- gsub("<b>","<b_open>",onepiece)
onepiece <- gsub("</b>","<b_close>",onepiece)
onepiece <- gsub("\","",onepiece)
onepiece
### <script> #############################################
### </script> ############################################
onepiece <- gsub("\\","",onepiece)
onepiece
onepiece <- gsub("\\","",onepiece)
onepiece[3]
onepiece[1]
str_detect(onepiece, "\\")
str_detect(onepiece, "\"")
onepiece <- gsub("\"","",onepiece)
onepiece
onepiece <- gsub("\n","", test_res)
onepiece <- gsub("<b>","<b_open>",onepiece)
onepiece <- gsub("</b>","<b_close>",onepiece)
onepiece
onepiece <- gsub("\n","", test_res)
onepiece
onepiece
onepiece <- test_res
onepiece
test <- fromJSON(onepiece)
test
View(test)
View(test)
test$items
View(test$items)
test[1,3]
test$items[1,3]
test$items[1,2]
test$items[14,3]
onepiece <- fromJSON(test_res)
(onepiece$items)
View(onepiece$items)
str_count(onepiece$items[1,1],pattern="<b>")
onepiece$items$cnt_kw_title <- str_count(onepiece$items, pattern="<b>")
cnt_kw_title <- str_count(onepiece$items, pattern="<b>")
cnt_kw_title <- str_count(onepiece$items[,1], pattern="<b>")
cnt_kw_title <- str_count(onepiece$items[,"title"], pattern="<b>")
cnt_kw_description <- str_count(onepiece$items[,"description"], pattern="<b>")
cnt_kw_description
onepiece$items$cnt_kw_t <- str_count(onepiece$items[,"title"], pattern="<b>")
onepiece$items$cnt_kw_d <- str_count(onepiece$items[,"description"], pattern="<b>")
View(onepiece)
View(onepiece$items)
as.Date(onepiece$items[1,"postdate"], format="yyyymmdd")
as.Date(onepiece$items[1,"postdate"], format="yyyy-mm-dd")
View(onepiece)
View(onepiece)
onepiece[["lastBuildDate"]]
as.Date(onepiece[["lastBuildDate"]])
date_ext <- onepiece[["lastBuildDate"]]
onepiece$items[1,"postdate"]
as.Date(onepiece$items[1,"postdate"],format="%y%m%d")
as.Date(onepiece$items[1,"postdate"],format="%Y%m%d")
onepiece[["lastBuildDate"]]
onepiece$items$postdate2 <- as.Date(onepiece$items[,"postdate"],format="%Y%m%d")
View(onepiece$items)
as.Date(onepiece[["lastBuildDate"]], format="%Y%m%d")
temp <- strsplit(onepiece[["lastBuildDate"]]," ")
temp
temp[1] <- gsub(",","",temp[1])
temp
temp <- strsplit(onepiece[["lastBuildDate"]]," ")
temp
temp <- unlist(temp)
temp
temp[1] <- gsub(",","",temp[1])
temp
temp <- paste(temp[1], temp[2], temp[3], temp[4])
temp
as.Date(temp, format="%a, %d %B %Y")
as.Date(temp, format="%a %d %B %Y")
as.Date(temp, format="%a %d %b %Y")
temp <- strsplit(onepiece[["lastBuildDate"]]," ")
temp <- unlist(temp)
temp[1] <- gsub(",","",temp[1])
temp <- paste(temp[1], temp[2], temp[3], temp[4])
temp
as.Date(temp, format="%a %d %b %Y")
temp <- strsplit(onepiece[["lastBuildDate"]]," ")
temp <- unlist(temp)
temp[1] <- gsub(",","",temp[1])
temp <- paste(temp[2], temp[3], temp[4])
temp
as.Date(temp, format="%d %b %Y")
as.Date(temp, format="%d %h %Y")
format("2013-03-03")
format("2013-03-03", "%d %h %Y")
format("2013-03-03", "%d %b %Y")
format(as.Date("2013-03-03"), "%d %b %Y")
format(as.Date("2013-03-03"), "%d %B %Y")
format(as.Date("2013-03-03"), "%d %B %Y")
?format
?switch
tf_month <- function(MONTH) {
switch (MONTH,
'Jan'="01",
'Feb'="02",
'Mar'="03",
'Apr'="04",
'May'="05",
'Jun'="06",
'Jul'="07",
'Aug'="08",
'Sep'="09",
'Oct'="10",
'Nov'="11",
'Dec'="12",
)
}
tf_month("May")
temp <- strsplit(onepiece[["lastBuildDate"]]," ")
temp <- unlist(temp)
temp[1] <- gsub(",","",temp[1])
temp <- paste(temp[2], tf_month(temp[3]), temp[4])
temp
as.Date(temp, "%d %m %Y")
temp <- as.Date(temp, "%d %m %Y")
onepiece[["lastBuildDate2"]] <- as.Date(temp, "%d %m %Y")
View(onepiece)
View(onepiece)
url_test <- onepiece$items[1,"link"]
url_test
html_test <- read_html(url_test)
library(xml2)
html_test <- read_html(url_test)
html_test
View(html_test)
View(html_test)
html_main <- html_test %>% html_node(".se-main-container") %>% html_text()
library(xml2); library(rvest)
html_main <- html_test %>% html_node(".se-main-container") %>% html_text()
html_main
View(html_test)
url_test
write_html(url_test, "html_test.html")
write_html(html_test, "html_test.html")
write(html_test, "html_test.txt")
html_main <- html_test %>% html_node("iframe") %>% html_text()
html_main
html_main <- html_test %>% html_node("body") %>% html_text()
html_main
html_test <- read_html(url_test)
xml_attrs(xml_child(xml_child(html_test, 5), 1))[["onload"]]
url_test <- "https://blog.naver.com/PostView.nhn?blogId=shh0289&logNo=222047382626&redirect=Dlog&widgetTypeCall=true&directAccess=false"
url_test
html_test <- read_html(url_test)
write_html(html_test,"html_test.html")
View(html_test)
View(html_test)
onepiece$items[1,"link"]
test_gsub <- onepiece$items[1,"link"]
test_blogId <- gsub("https://blog.naver.com/","",test_gsub)
test_blogId
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub
test_gsub <- unlist(strsplit(test_gsub, "?"))
test_gsub
test_gsub <- onepiece$items[1,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- strsplit(test_gsub, "\?")
test_gsub <- strsplit(test_gsub, "?")
test_gsub
test_gsub <- onepiece$items[1,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub
test_gsub <- str_split(test_gsub,"?")
test_gsub <- strsplit(test_gsub, "=")
test_gsub
test_gsub <- onepiece$items[1,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub
test_gsub <- gsub("?","=",test_gsub)
test_gsub
test_gsub <- onepiece$items[1,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("\?","=",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub
test_gsub <- strsplit(test_gsub, "=")
test_gsub
View(onepiece)
View(onepiece$items)
test_blogId <- test_gsub[1]; test_logNo=test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
url_test
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
test_blogId
test_gsub <- unlist(strsplit(test_gsub, "="))
test_gsub
test_gsub <- unlist(test_gsub)
test_gsub
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
test_blogId
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
url_test
html_test <- read_html(url_test)
write_html(html_test,"html_test.html")
html_main <- html_test %>% html_node("div.se-main-container") %>% html_text()
html_main
write(html_main, "html_main.txt")
onepiece$items$cnt_kw_t[1]
onepiece$items$cnt_kw_m[1] <- str_count(html_main, pattern="원피스")
View(onepiece$items)
html_main <- html_test %>% html_node("div.se-main-container")
write(html_main, "html_main.txt")
html_main
View(html_main)
View(html_main)
write(html_main, "html_main.html")
View(html_test)
View(html_test)
View(html_main)
View(html_main)
View(html_test)
View(html_main)
write_html(html_test,"html_test.html")
write(html_main, "html_main.html")
html_main <- html_test %>% html_node("div.se-main-container") %>% html()
html_main <- html_test %>% html_node("div.se-main-container") %>% html_form()
html_main <- html_test %>% html_node("div.se-main-container") %>% html_node()
html_main <- html_test %>% html_node("div.se-main-container") %>% html_text()
html_main <- html_test %>% html_node("div.se-main-container") %>% html_tag()
html_main <- html_test %>% html_node("div.se-main-container") %>% html()
html_main <- html_test %>% html_node("div.se-main-container") %>% html_text(trim=T)
html_main
html_main <- html_test %>% html_node("div.se-main-container")
html_main
write(html_main, "html_main.html")
View(html_main)
View(html_main)
write_html(html_main, "html_main.html")
html_main <- html_test %>% html_node("div.se-main-container")
onepiece$items$cnt_kw_m[1] <- str_count(html_main, pattern="원피스")
View(onepiece$items)
onepiece$items$cnt_href_m[1] <- str_count(html_main, pattern="<a href=\"http")
View(onepiece$items)
test_res
# 본문 스크래핑
test_gsub <- data$items[,"link"]
glaemfdj <- function(RAWDATA){
data <- fromJSON(RAWDATA)
# 글 제목에 들어있는 키워드 수
data$items$cnt_kw_t <- str_count(data$items[,"title"], pattern="<b>")
# 글 본문 요약에 들어있는 키워드 수
data$items$cnt_kw_d <- str_count(data$items[,"description"], pattern="<b>")
# 작성일을 data 구조로 변경
data$items$postdate2 <- as.Date(data$items[,"postdate"],format="%Y%m%d")
# 검색기준일을 data 구조로 변경
temp <- strsplit(data[["lastBuildDate"]]," ")
temp <- unlist(temp)
temp[1] <- gsub(",","",temp[1])
temp <- paste(temp[2], tf_month(temp[3]), temp[4])
data[["lastBuildDate2"]] <- as.Date(temp, "%d %m %Y")
# 본문 스크래핑
for (i in 1:100){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container")
write_html(html_main, "html_main.html")
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
return(data)
}
test_res2 <- glaemfdj(test_res)
View(onepiece)
warnings()
RAWDATA=test_res
data <- fromJSON(RAWDATA)
# 글 제목에 들어있는 키워드 수
data$items$cnt_kw_t <- str_count(data$items[,"title"], pattern="<b>")
# 글 본문 요약에 들어있는 키워드 수
data$items$cnt_kw_d <- str_count(data$items[,"description"], pattern="<b>")
# 작성일을 data 구조로 변경
data$items$postdate2 <- as.Date(data$items[,"postdate"],format="%Y%m%d")
rm(onepiece)
# 글 제목에 들어있는 키워드 수
data$items$cnt_kw_t <- str_count(data$items[,"title"], pattern="<b>")
# 글 본문 요약에 들어있는 키워드 수
data$items$cnt_kw_d <- str_count(data$items[,"description"], pattern="<b>")
# 작성일을 data 구조로 변경
data$items$postdate2 <- as.Date(data$items[,"postdate"],format="%Y%m%d")
View(data)
View(data)
# 검색기준일을 data 구조로 변경
temp <- strsplit(data[["lastBuildDate"]]," ")
temp <- unlist(temp)
temp[1] <- gsub(",","",temp[1])
temp <- paste(temp[2], tf_month(temp[3]), temp[4])
data[["lastBuildDate2"]] <- as.Date(temp, "%d %m %Y")
View(data)
View(data)
# 본문 스크래핑
for (i in 1:100){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container")
write_html(html_main, "html_main.html")
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
# 본문 스크래핑
for (i in 1:2){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container")
write_html(html_main, "html_main.html")
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
View(data$items)
# 본문 스크래핑
for (i in 1:14){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container")
write_html(html_main, "html_main.html")
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
# 본문 스크래핑
for (i in 15:16){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container")
write_html(html_main, "html_main.html")
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
i=15
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container")
write_html(html_main, "html_main.html")
html_test
url_test
tryCatch(
html_main <- html_test %>% html_node("div.se-main-container"),
error = function(){
print("이 글은 모바일에서 작성되었습니다.")
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")
}
)
View(html_main)
View(html_main)
html_node
tryCatch(
write_html(html_main, "html_main.html"),
error = function(){
print("이 글은 모바일에서 작성되었습니다.")
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")
}
)
tryCatch(
write_html(html_main, "html_main.html"),
error = function(e){
print("이 글은 모바일에서 작성되었습니다.")
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")
}
)
View(html_main)
View(html_main)
View(html_main)
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")
length(html_main)
html_main <- html_test %>% html_node("div.se-main-container") # pc
length(html_main)
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")  # mobile
if (length(html_main)==0){
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")  # mobile
}
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
# 본문 스크래핑
for (i in 15:16){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container") # pc
if (length(html_main)==0){
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")  # mobile
}
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
# 본문 스크래핑
for (i in 17:100){
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container") # pc
if (length(html_main)==0){
html_main <- html_test %>% html_node("div.se_component_wrap.sect_dsc.__se_component_area")  # mobile
}
data$items$cnt_kw_m[i] <- str_count(html_main, pattern="원피스")
data$items$cnt_href_m[i] <- str_count(html_main, pattern="<a href=\"http")
}
View(data)
View(data)
View(data$items)
i = 85
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
html_test <- read_html(url_test)
html_main <- html_test %>% html_node("div.se-main-container") # pc
test_gsub <- data$items[i,"link"]
test_gsub <- gsub("https://blog.naver.com/","",test_gsub)
test_gsub <- gsub("[?]","=",test_gsub)
test_gsub <- strsplit(test_gsub, "=")
test_gsub <- unlist(test_gsub)
test_blogId <- test_gsub[1]; test_logNo <- test_gsub[4]
url_test <- paste("https://blog.naver.com/PostView.nhn?blogId=",test_blogId,"&logNo=",test_logNo,"&redirect=Dlog&widgetTypeCall=true&directAccess=false",sep="")
url_test
html_test <- read_html(url_test)
